{"version":3,"sources":["input.js"],"names":["upperChild","document","querySelector","oLine","downChild","downHeight","clientHeight","upperHeight","emojiBtn","getElementById","imageBtn","fileBtn","editFullScreen","exitFullScreen","emojiMart","toolMusk","sendBtn","chatInput","pickerOptions","onEmojiSelect","e","style","display","insertAtCursor","native","picker","EmojiMart","Picker","appendChild","myField","myValue","editor","html","focus","window","getSelection","selection","getRangeAt","rangeCount","range","deleteContents","element","createElement","innerHTML","node","lastNode","fragment","createDocumentFragment","firstChild","insertNode","cloneRange","setStartAfter","collapse","removeAllRanges","addRange","type","createRange","pasteHTML","onmousedown","ev","olineOriBgColor","backgroundColor","iEvent","event","dy","clientY","offsetHeight","onmousemove","diff","height","onmouseup","onclick","emojiHeight","bottom","top","addImage","file","Promise","resolve","reject","reader","FileReader","onload","src","target","result","img","Image","imgStr","outerHTML","readAsDataURL","inputFile","settings","console","log","maxImageSize","undefined","maxImageNumber","enable","imageInput","accept","multiple","onchange","imgNum","getElementsByTagName","length","i","files","size","sendFile","click","sendFileFunc","fileInput","enableDrop","ondrop","preventDefault","stopPropagation","border","dataTransfer","indexOf","ondragover","ondragleave","addEventListener","onPaste","clipboardData","getData","text","execCommand"],"mappings":"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","file":"../litewebchat_input.js","sourcesContent":["// !参考资料来源：\n// !https://blog.csdn.net/weixin_40629244/article/details/104642683\n// !https://github.com/jrainlau/chat-input-box\n// !https://www.zhihu.com/question/20893119/answer/19452676\n// !致谢：感谢@jrainlau提供的思路和代码，我在他的富文本编辑器基础上进行了修改，使其能够在聊天输入框中使用\n// ————YubaC 2023.1.23\n\n// --------------------------------\n// 上半部分的聊天区域\nlet upperChild = document.querySelector('.lite-chatbox');\n// 分界线\nlet oLine = document.querySelector('.lite-chatinput hr');\n// 下半部分的输入框区域\nlet downChild = document.querySelector('.lite-chatinput');\n\nvar downHeight = downChild.clientHeight;\nvar upperHeight = upperChild.clientHeight;\n\n// 以下为输入框区域的按钮\nvar emojiBtn = document.getElementById(\"emojiBtn\"); // 表情按钮\nvar imageBtn = document.getElementById(\"imageBtn\"); // 图片按钮\nvar fileBtn = document.getElementById(\"fileBtn\"); // 文件按钮\nvar editFullScreen = document.getElementById(\"editFullScreen\"); // 全屏按钮\nvar exitFullScreen = document.getElementById(\"exitFullScreen\"); // 退出全屏按钮\nvar emojiMart = document.getElementById(\"emojiMart\"); // 表情面板\nvar toolMusk = document.getElementById(\"toolMusk\"); // 表情面板遮罩\nvar sendBtn = document.getElementById(\"sendBtn\"); // 发送按钮\nvar chatInput = document.querySelector('.lite-chatinput>.chatinput'); // 输入框\n// --------------------------------\n\n// Emoji Mart（表情面板）设置及唤起\nvar pickerOptions = {\n  \"locale\": \"zh\",\n  onEmojiSelect: function (e) {\n    // console.log(e.native);\n    emojiMart.style.display = \"none\";\n    toolMusk.style.display = \"none\";\n    insertAtCursor(chatInput, e.native);\n    // insertEmoji(e.native);\n  }\n}\nvar picker = new EmojiMart.Picker(pickerOptions);\nemojiMart.appendChild(picker);\n\n// 负责在光标处插入文字的函数\nfunction insertAtCursor(myField, myValue) {\n  var editor = myField;\n  var html = myValue;\n  editor.focus();\n\n  if (window.getSelection) {\n    var selection = window.getSelection();\n    if (selection.getRangeAt && selection.rangeCount) {\n      var range = selection.getRangeAt(0);\n      range.deleteContents();\n      var element = document.createElement('div');\n      element.innerHTML = html;\n\n      var node;\n      var lastNode;\n      var fragment = document.createDocumentFragment();\n\n      while ((node = element.firstChild)) {\n        lastNode = fragment.appendChild(node);\n      };\n\n      range.insertNode(fragment);\n      if (lastNode) {\n        range = range.cloneRange();\n        range.setStartAfter(lastNode);\n        range.collapse(true);\n        selection.removeAllRanges();\n        selection.addRange(range);\n      };\n    }\n\n  } else if (document.selection && document.selection.type != 'Control') {\n    editor.focus();\n    var range = document.selection.createRange();\n    range.pasteHTML(html);\n    editor.focus();\n  }\n}\n\n// 调整聊天区域和输入框区域比例的函数\noLine.onmousedown = function (ev) {\n  // 更改oLine颜色为蓝色，方便查看分界线\n  const olineOriBgColor = oLine.style.backgroundColor;\n  oLine.style.backgroundColor = \"#1E90FF\";\n  var iEvent = ev || event;\n  var dy = iEvent.clientY; //当你第一次单击的时候，存储y轴的坐标。//相对于浏览器窗口\n  upperHeight = upperChild.offsetHeight;\n  downHeight = downChild.offsetHeight;\n  document.onmousemove = function (ev) {\n    var iEvent = ev || event;\n    var diff = iEvent.clientY - dy; //移动的距离（向上滑时为负数,下滑时为正数）\n    if (100 < (upperHeight + diff) && 100 < (downHeight - diff)) {\n      //两个div的最小高度均为100px\n      upperChild.style.height = `calc(100% - ${downHeight - diff}px)`;\n      downChild.style.height = (downHeight - diff) + 'px';\n    }\n  };\n  document.onmouseup = function () {\n    // 更改oLine颜色为原色\n    oLine.style.backgroundColor = olineOriBgColor;\n    document.onmousedown = null;\n    document.onmousemove = null;\n  };\n  return false;\n}\n\n// 显示表情输入框\nemojiBtn.onclick = function () {\n  emojiMart.style.display = \"block\";\n  toolMusk.style.display = \"block\";\n\n  let emojiHeight = emojiMart.offsetHeight;\n   downHeight = downChild.clientHeight;\n   upperHeight = upperChild.clientHeight;\n\n  if (emojiHeight < upperHeight) {\n    emojiMart.style.bottom = `${downHeight + 3}px`\n    emojiMart.style.top = '';\n  } else {\n    emojiMart.style.bottom = ''\n    emojiMart.style.top = '10px';\n  }\n\n}\n\n// 全屏编辑文字\neditFullScreen.onclick = function () {\n  downHeight = downChild.clientHeight;\n  upperHeight = upperChild.clientHeight;\n  downChild.style.height = `100%`;\n  upperChild.style.height = \"0px\";\n  editFullScreen.style.display = \"none\";\n  exitFullScreen.style.display = \"block\";\n  oLine.style.display = \"none\";\n}\n\n// 退出全屏编辑文字\nexitFullScreen.onclick = function () {\n  // 防呆不防傻，用于避免上部聊天窗口被压到没有高度后出现异常\n  if (upperHeight != 0) {\n    downChild.style.height = `${downHeight}px`;\n    upperChild.style.height = `calc(100% - ${downHeight}px)`;\n  } else {\n    upperChild.style.height = \"calc(100% - 150px)\";\n    downChild.style.height = \"150px\";\n  }\n\n  exitFullScreen.style.display = \"none\";\n  editFullScreen.style.display = \"block\";\n  oLine.style.display = \"block\";\n}\n\n// 隐藏musk和表情输入框\ntoolMusk.onclick = function () {\n  emojiMart.style.display = \"none\";\n  toolMusk.style.display = \"none\";\n}\n\n// 将图片插入到输入框中\nfunction addImage(file) {\n  new Promise((resolve, reject) => {\n    // console.log(file);\n    // 获取file的src\n    var reader = new FileReader();\n    reader.onload = function (e) {\n      var src = e.target.result;\n      var img = new Image();\n      img.src = src;\n\n      // *这里的方法已经转移到了css里，暂时弃用\n      // // 为了防止图片在输入框内显示过大不好编辑\n      // img.style.width = \"100px\";\n      // 将img从HEMLElement转化为字符串\n      // 例如，转化结束后为'<img src=\"\">'\n      var imgStr = img.outerHTML;\n      // 将img字符串插入到输入框中\n      insertAtCursor(chatInput, imgStr);\n    }\n    reader.readAsDataURL(file);\n  })\n}\n\n// 上传图片、文件\nfunction inputFile(settings) {\n  console.log(settings);\n  // -----------------设置最大图片大小及数量-----------------\n  if (settings.maxImageSize != undefined) {\n    var maxImageSize = settings.maxImageSize;\n  } else {\n    var maxImageSize = -1;\n  }\n\n  if (settings.maxImageNumber != undefined) {\n    var maxImageNumber = settings.maxImageNumber;\n  } else {\n    var maxImageNumber = -1;\n  }\n\n  if (settings.enable) {\n    // -----------------上传图片的按钮-----------------\n    imageBtn.onclick = function () {\n      var imageInput = document.createElement('input');\n      imageInput.type = 'file';\n      imageInput.accept = 'image/*';\n      imageInput.multiple = true;\n      imageInput.style.display = 'none';\n      imageInput.onchange = function () {\n        // 获取输入框内图片数量\n        // 获取文件\n        var imgNum = chatInput.getElementsByTagName('img').length;\n        for (var i = 0; i < this.files.length; i++) {\n          if (maxImageNumber == -1 || imgNum < maxImageNumber) {\n            // 如果大小超过限制，改用文件上传\n            if ((maxImageSize == -1 || this.files[i].size <= maxImageSize)) {\n              imgNum++;\n              addImage(this.files[i]);\n            } else {\n              sendFile(this.files[i]);\n            }\n          }\n        }\n      }\n      // 触发点击事件\n      imageInput.click();\n    }\n    // -----------------上传文件的按钮-----------------\n    let sendFile = settings.sendFileFunc;\n    // 上传文件按钮\n    fileBtn.onclick = function () {\n      // 创建一个隐藏的上传文件的input，再借助点击这个input来上传文件\n      var fileInput = document.createElement('input');\n      fileInput.type = 'file';\n      fileInput.multiple = true;\n      fileInput.style.display = 'none';\n      fileInput.onchange = function () {\n        // 获取文件\n        for (var i = 0; i < this.files.length; i++) {\n          var file = this.files[i];\n          sendFile(file);\n        }\n      }\n      // 触发点击事件\n      fileInput.click();\n    }\n\n    // -----------------拖拽上传-----------------\n    if (settings.enableDrop) {\n      // 当downChild有文件被拖入时，也调用上传文件的函数\n      downChild.ondrop = function (e) {\n        e.preventDefault();\n        // 阻止火狐浏览器默认打开文件的行为\n        e.stopPropagation();\n        downChild.style.border = \"none\";\n        // 获取被拖拽的文件并上传\n        var imgNum = chatInput.getElementsByTagName('img').length;\n        for (var i = 0; i < e.dataTransfer.files.length; i++) {\n          var file = e.dataTransfer.files[i];\n          // 如果是图片，直接插入到输入框中\n          if (file.type.indexOf(\"image\") == 0) {\n            if (maxImageNumber == -1 || imgNum < maxImageNumber) {\n              // 如果大小超过限制，改用文件上传\n              if ((maxImageSize == -1 || file.size <= maxImageSize)) {\n                addImage(file);\n                imgNum++;\n              } else {\n                sendFile(file);\n              }\n            }\n          } else {\n            sendFile(file);\n          }\n        }\n      }\n\n      // 当downChild有文件被拖入时，改变downChild的边框颜色\n      downChild.ondragover = function (e) {\n        e.preventDefault();\n        downChild.style.border = \"3px solid #1E90FF\";\n      }\n\n      // 当downChild有文件被拖入后离开时，改回downChild的边框颜色\n      downChild.ondragleave = function (e) {\n        e.preventDefault();\n        downChild.style.border = \"none\";\n      }\n    }\n  } else {\n    // 如果不允许上传，那么删除事件\n    imageBtn.onclick = null;\n    fileBtn.onclick = null;\n    // 删除拖拽事件\n    downChild.ondrop = null;\n    downChild.ondragover = null;\n    downChild.ondragleave = null;\n  }\n}\n\n// TODO:可能富文本输入框的粘贴部分需要对Chrome浏览器做部分额外适配，以优化体验\n// 无格式粘贴\nchatInput.addEventListener('paste', function (e) {\n  onPaste(e);\n})\n\n//格式化粘贴文本方法\nfunction onPaste(event) {\n  // 如果粘贴的是文本，就清除格式后粘贴\n  if (event.clipboardData && event.clipboardData.getData) {\n    var text = event.clipboardData.getData('text/plain');\n    if (text) {\n      event.preventDefault();\n      document.execCommand('insertText', false, text);\n    }\n  }\n}\n\nwindow.addEventListener('DOMContentLoaded', function () {\n  chatInput.focus();\n});\n"]}