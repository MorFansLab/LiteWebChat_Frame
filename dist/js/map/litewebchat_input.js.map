{"version":3,"sources":["input.js"],"names":["upperChild","document","querySelector","oLine","downChild","emojiBtn","getElementById","imageBtn","fileBtn","editFullScreen","exitFullScreen","emojiMart","toolMusk","sendBtn","chatInput","pickerOptions","onEmojiSelect","e","style","display","insertAtCursor","native","picker","EmojiMart","Picker","appendChild","myField","myValue","editor","html","focus","window","getSelection","selection","getRangeAt","rangeCount","range","deleteContents","element","createElement","innerHTML","node","lastNode","fragment","createDocumentFragment","firstChild","insertNode","cloneRange","setStartAfter","collapse","removeAllRanges","addRange","type","createRange","pasteHTML","onmousedown","ev","backgroundColor","iEvent","event","dy","clientY","upperHeight","offsetHeight","downHeight","onmousemove","diff","height","onmouseup","onclick","emojiHeight","clientHeight","bottom","top","addImage","file","Promise","resolve","reject","reader","FileReader","onload","src","target","result","img","Image","imgStr","outerHTML","readAsDataURL","inputFile","settings","console","log","maxImageSize","undefined","maxImageNumber","enable","imageInput","accept","multiple","onchange","imgNum","getElementsByTagName","length","i","files","size","sendFile","click","sendFileFunc","fileInput","enableDrop","ondrop","preventDefault","stopPropagation","border","dataTransfer","indexOf","ondragover","ondragleave","addEventListener","onPaste","clipboardData","getData","text","execCommand"],"mappings":"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","file":"../litewebchat_input.js","sourcesContent":["// !参考资料来源：\n// !https://blog.csdn.net/weixin_40629244/article/details/104642683\n// !https://github.com/jrainlau/chat-input-box\n// !https://www.zhihu.com/question/20893119/answer/19452676\n// !致谢：感谢@jrainlau提供的思路和代码，我在他的富文本编辑器基础上进行了修改，使其能够在聊天输入框中使用\n// ————YubaC 2023.1.23\n\n// --------------------------------\n// 上半部分的聊天区域\nlet upperChild = document.querySelector('.lite-chatbox');\n// 分界线\nlet oLine = document.querySelector('.lite-chatinput hr');\n// 下半部分的输入框区域\nlet downChild = document.querySelector('.lite-chatinput');\n\n// 以下为输入框区域的按钮\nvar emojiBtn = document.getElementById(\"emojiBtn\"); // 表情按钮\nvar imageBtn = document.getElementById(\"imageBtn\"); // 图片按钮\nvar fileBtn = document.getElementById(\"fileBtn\"); // 文件按钮\nvar editFullScreen = document.getElementById(\"editFullScreen\"); // 全屏按钮\nvar exitFullScreen = document.getElementById(\"exitFullScreen\"); // 退出全屏按钮\nvar emojiMart = document.getElementById(\"emojiMart\"); // 表情面板\nvar toolMusk = document.getElementById(\"toolMusk\"); // 表情面板遮罩\nvar sendBtn = document.getElementById(\"sendBtn\"); // 发送按钮\nvar chatInput = document.querySelector('.lite-chatinput>.chatinput'); // 输入框\n// --------------------------------\n\n// Emoji Mart（表情面板）设置及唤起\nvar pickerOptions = {\n    \"locale\": \"zh\",\n    onEmojiSelect: function(e) {\n        // console.log(e.native);\n        emojiMart.style.display = \"none\";\n        toolMusk.style.display = \"none\";\n        insertAtCursor(chatInput, e.native);\n        // insertEmoji(e.native);\n    }\n}\nvar picker = new EmojiMart.Picker(pickerOptions);\nemojiMart.appendChild(picker);\n\n// 负责在光标处插入文字的函数\nfunction insertAtCursor(myField, myValue) {\n    var editor = myField;\n    var html = myValue;\n    editor.focus();\n\n    if (window.getSelection) {\n        var selection = window.getSelection();\n        if (selection.getRangeAt && selection.rangeCount) {\n            var range = selection.getRangeAt(0);\n            range.deleteContents();\n            var element = document.createElement('div');\n            element.innerHTML = html;\n\n            var node;\n            var lastNode;\n            var fragment = document.createDocumentFragment();\n\n            while ((node = element.firstChild)) {\n                lastNode = fragment.appendChild(node);\n            };\n\n            range.insertNode(fragment);\n            if (lastNode) {\n                range = range.cloneRange();\n                range.setStartAfter(lastNode);\n                range.collapse(true);\n                selection.removeAllRanges();\n                selection.addRange(range);\n            };\n        }\n\n    } else if (document.selection && document.selection.type != 'Control') {\n        editor.focus();\n        var range = document.selection.createRange();\n        range.pasteHTML(html);\n        editor.focus();\n    }\n}\n\n// 调整聊天区域和输入框区域比例的函数\noLine.onmousedown = function(ev) {\n    // 更改oLine颜色为蓝色，方便查看分界线\n    oLine.style.backgroundColor = \"#1E90FF\";\n    var iEvent = ev || event;\n    var dy = iEvent.clientY; //当你第一次单击的时候，存储y轴的坐标。//相对于浏览器窗口\n    var upperHeight = upperChild.offsetHeight;\n    var downHeight = downChild.offsetHeight;\n    document.onmousemove = function(ev) {\n        var iEvent = ev || event;\n        var diff = iEvent.clientY - dy; //移动的距离（向上滑时为负数,下滑时为正数）\n        if (100 < (upperHeight + diff) && 100 < (downHeight - diff)) {\n            //两个div的最小高度均为100px\n            upperChild.style.height = `calc(100% - ${downHeight - diff}px)`;\n            downChild.style.height = (downHeight - diff) + 'px';\n        }\n    };\n    document.onmouseup = function() {\n        // 更改oLine颜色为白色\n        oLine.style.backgroundColor = \"#fff\";\n        document.onmousedown = null;\n        document.onmousemove = null;\n    };\n    return false;\n}\n\n// 显示表情输入框\nemojiBtn.onclick = function() {\n    emojiMart.style.display = \"block\";\n    toolMusk.style.display = \"block\";\n\n    let emojiHeight = emojiMart.offsetHeight;\n    var downHeight = downChild.clientHeight;\n    var upperHeight = upperChild.clientHeight;\n\n    if (emojiHeight < upperHeight) {\n        emojiMart.style.bottom = `${downHeight + 3}px`\n        emojiMart.style.top = '';\n    } else {\n        emojiMart.style.bottom = ''\n        emojiMart.style.top = '10px';\n    }\n\n}\n\n// 全屏编辑文字\neditFullScreen.onclick = function() {\n    var downHeight = downChild.clientHeight;\n    var upperHeight = upperChild.clientHeight;\n    downChild.style.height = `100%`;\n    upperChild.style.height = \"0px\";\n    editFullScreen.style.display = \"none\";\n    exitFullScreen.style.display = \"block\";\n    oLine.style.display = \"none\";\n}\n\n// 退出全屏编辑文字\nexitFullScreen.onclick = function() {\n    // 防呆不防傻，用于避免上部聊天窗口被压到没有高度后出现异常\n    if (upperHeight != 0) {\n        downChild.style.height = `${downHeight}px`;\n        upperChild.style.height = `calc(100% - ${downHeight}px)`;\n    } else {\n        upperChild.style.height = \"calc(100% - 150px)\";\n        downChild.style.height = \"150px\";\n    }\n\n    exitFullScreen.style.display = \"none\";\n    editFullScreen.style.display = \"block\";\n    oLine.style.display = \"block\";\n}\n\n// 隐藏musk和表情输入框\ntoolMusk.onclick = function() {\n    emojiMart.style.display = \"none\";\n    toolMusk.style.display = \"none\";\n}\n\n// 将图片插入到输入框中\nfunction addImage(file) {\n    new Promise((resolve, reject) => {\n        // console.log(file);\n        // 获取file的src\n        var reader = new FileReader();\n        reader.onload = function(e) {\n            var src = e.target.result;\n            var img = new Image();\n            img.src = src;\n\n            // *这里的方法已经转移到了css里，暂时弃用\n            // // 为了防止图片在输入框内显示过大不好编辑\n            // img.style.width = \"100px\";\n            // 将img从HEMLElement转化为字符串\n            // 例如，转化结束后为'<img src=\"\">'\n            var imgStr = img.outerHTML;\n            // 将img字符串插入到输入框中\n            insertAtCursor(chatInput, imgStr);\n        }\n        reader.readAsDataURL(file);\n    })\n}\n\n// 上传图片、文件\nfunction inputFile(settings) {\n    console.log(settings);\n    // -----------------设置最大图片大小及数量-----------------\n    if (settings.maxImageSize != undefined) {\n        var maxImageSize = settings.maxImageSize;\n    } else {\n        var maxImageSize = -1;\n    }\n\n    if (settings.maxImageNumber != undefined) {\n        var maxImageNumber = settings.maxImageNumber;\n    } else {\n        var maxImageNumber = -1;\n    }\n\n    if (settings.enable) {\n        // -----------------上传图片的按钮-----------------\n        imageBtn.onclick = function() {\n                var imageInput = document.createElement('input');\n                imageInput.type = 'file';\n                imageInput.accept = 'image/*';\n                imageInput.multiple = true;\n                imageInput.style.display = 'none';\n                imageInput.onchange = function() {\n                        // 获取输入框内图片数量\n                        // 获取文件\n                        var imgNum = chatInput.getElementsByTagName('img').length;\n                        for (var i = 0; i < this.files.length; i++) {\n                            if (maxImageNumber == -1 || imgNum < maxImageNumber) {\n                                // 如果大小超过限制，改用文件上传\n                                if ((maxImageSize == -1 || this.files[i].size <= maxImageSize)) {\n                                    imgNum++;\n                                    addImage(this.files[i]);\n                                } else {\n                                    sendFile(this.files[i]);\n                                }\n                            }\n                        }\n                    }\n                    // 触发点击事件\n                imageInput.click();\n            }\n            // -----------------上传文件的按钮-----------------\n        let sendFile = settings.sendFileFunc;\n        // 上传文件按钮\n        fileBtn.onclick = function() {\n            // 创建一个隐藏的上传文件的input，再借助点击这个input来上传文件\n            var fileInput = document.createElement('input');\n            fileInput.type = 'file';\n            fileInput.multiple = true;\n            fileInput.style.display = 'none';\n            fileInput.onchange = function() {\n                    // 获取文件\n                    for (var i = 0; i < this.files.length; i++) {\n                        var file = this.files[i];\n                        sendFile(file);\n                    }\n                }\n                // 触发点击事件\n            fileInput.click();\n        }\n\n        // -----------------拖拽上传-----------------\n        if (settings.enableDrop) {\n            // 当downChild有文件被拖入时，也调用上传文件的函数\n            downChild.ondrop = function(e) {\n                e.preventDefault();\n                // 阻止火狐浏览器默认打开文件的行为\n                e.stopPropagation();\n                downChild.style.border = \"none\";\n                // 获取被拖拽的文件并上传\n                var imgNum = chatInput.getElementsByTagName('img').length;\n                for (var i = 0; i < e.dataTransfer.files.length; i++) {\n                    var file = e.dataTransfer.files[i];\n                    // 如果是图片，直接插入到输入框中\n                    if (file.type.indexOf(\"image\") == 0) {\n                        if (maxImageNumber == -1 || imgNum < maxImageNumber) {\n                            // 如果大小超过限制，改用文件上传\n                            if ((maxImageSize == -1 || file.size <= maxImageSize)) {\n                                addImage(file);\n                                imgNum++;\n                            } else {\n                                sendFile(file);\n                            }\n                        }\n                    } else {\n                        sendFile(file);\n                    }\n                }\n            }\n\n            // 当downChild有文件被拖入时，改变downChild的边框颜色\n            downChild.ondragover = function(e) {\n                e.preventDefault();\n                downChild.style.border = \"3px solid #1E90FF\";\n            }\n\n            // 当downChild有文件被拖入后离开时，改回downChild的边框颜色\n            downChild.ondragleave = function(e) {\n                e.preventDefault();\n                downChild.style.border = \"none\";\n            }\n        }\n    } else {\n        // 如果不允许上传，那么删除事件\n        imageBtn.onclick = null;\n        fileBtn.onclick = null;\n        // 删除拖拽事件\n        downChild.ondrop = null;\n        downChild.ondragover = null;\n        downChild.ondragleave = null;\n    }\n}\n\n// TODO:可能富文本输入框的粘贴部分需要对Chrome浏览器做部分额外适配，以优化体验\n// 无格式粘贴\nchatInput.addEventListener('paste', function(e) {\n    onPaste(e);\n})\n\n//格式化粘贴文本方法\nfunction onPaste(event) {\n    // 如果粘贴的是文本，就清除格式后粘贴\n    if (event.clipboardData && event.clipboardData.getData) {\n        var text = event.clipboardData.getData('text/plain');\n        if (text) {\n            event.preventDefault();\n            document.execCommand('insertText', false, text);\n        }\n    }\n}\n\nwindow.addEventListener('DOMContentLoaded', function() {\n    chatInput.focus();\n});\n"]}